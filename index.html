<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CubeSigner Google Login Test</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial,
          sans-serif;
        margin: 0;
        padding: 1.5rem 2rem;
        background: #f5f5f5;
        color: #1a1a1a;
        max-width: 960px;
        margin-left: auto;
        margin-right: auto;
      }

      h1 {
        font-size: 1.25rem;
        margin: 0 0 0.15rem;
      }

      .subtitle {
        color: #888;
        font-size: 0.8rem;
        margin: 0 0 1rem;
      }

      /* ── Collapsible config ── */

      .config-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 8px 8px 0 0;
        padding: 0.6rem 1rem;
        margin-bottom: 0;
        cursor: pointer;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #666;
        width: 100%;
        text-align: left;
      }

      .config-toggle:hover {
        background: #fafafa;
      }

      .config-toggle .chevron {
        transition: transform 0.15s ease;
        font-size: 0.65rem;
      }

      .config-toggle.collapsed .chevron {
        transform: rotate(-90deg);
      }

      .config-toggle.collapsed {
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .config-body {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-top: none;
        border-radius: 0 0 8px 8px;
        padding: 0.75rem 1rem 1rem;
        margin-bottom: 1rem;
      }

      .config-body.hidden {
        display: none;
      }

      .form-row {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }

      .form-row:last-child {
        margin-bottom: 0;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
        flex: 1;
        min-width: 180px;
      }

      .form-group label {
        font-size: 0.7rem;
        font-weight: 600;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }

      .form-group input,
      .form-group textarea {
        padding: 0.45rem 0.65rem;
        border: 1px solid #d0d0d0;
        border-radius: 4px;
        font-size: 0.8rem;
        font-family: inherit;
      }

      .form-group textarea {
        font-family: "SF Mono", "Fira Code", "Fira Mono", Menlo, Consolas, monospace;
        font-size: 0.75rem;
        min-height: 72px;
        resize: vertical;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .form-group input[readonly] {
        background: #f0f0f0;
        color: #888;
        cursor: not-allowed;
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #4285f4;
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.12);
      }

      /* ── Buttons ── */

      button {
        border: 1px solid #d0d0d0;
        background: #fff;
        color: #1a1a1a;
        border-radius: 6px;
        font-size: 0.8rem;
        line-height: 1;
        padding: 0.55rem 0.75rem;
        cursor: pointer;
        font-weight: 500;
      }

      button:hover {
        background: #f8f8f8;
      }

      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }

      button.primary {
        border-color: #3773d6;
        background: #4285f4;
        color: #fff;
        font-weight: 600;
      }

      button.primary:hover:not(:disabled) {
        background: #3773d6;
      }

      #google-signin-btn {
        min-height: 44px;
      }

      /* ── Tabs ── */

      .tab-bar {
        display: flex;
        gap: 0;
        border-bottom: 2px solid #e0e0e0;
        margin-bottom: 0;
        overflow-x: auto;
      }

      .tab-btn {
        position: relative;
        padding: 0.55rem 0.9rem;
        border: none;
        border-bottom: 2px solid transparent;
        background: none;
        color: #888;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        white-space: nowrap;
        margin-bottom: -2px;
        border-radius: 0;
        transition: color 0.12s, border-color 0.12s;
      }

      .tab-btn:hover {
        color: #444;
        background: rgba(0, 0, 0, 0.02);
      }

      .tab-btn.active {
        color: #4285f4;
        border-bottom-color: #4285f4;
      }

      .tab-btn .tab-dot {
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #34a853;
        margin-left: 5px;
        vertical-align: middle;
        opacity: 0;
        transition: opacity 0.15s ease;
      }

      .tab-btn .tab-dot.done {
        opacity: 1;
      }

      /* ── Tab panels ── */

      .tab-panel {
        display: none;
      }

      .tab-panel.active {
        display: block;
      }

      .step-card {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-top: none;
        border-radius: 0 0 8px 8px;
        padding: 1rem 1.25rem 1.25rem;
      }

      .step-header {
        font-size: 0.85rem;
        font-weight: 600;
        color: #333;
        margin: 0 0 0.35rem;
      }

      .step-description {
        margin: 0 0 0.75rem;
        font-size: 0.8rem;
        color: #777;
        line-height: 1.45;
      }

      /* ── Output ── */

      .output-block {
        margin-top: 0.75rem;
        border: 1px dashed #d8d8d8;
        border-radius: 6px;
        background: #fafbfc;
        padding: 0.5rem 0.6rem;
      }

      .output-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.3rem;
      }

      .output-title {
        font-size: 0.65rem;
        font-weight: 700;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }

      .copy-btn {
        font-size: 0.65rem;
        padding: 0.15rem 0.4rem;
        border: 1px solid #ddd;
        border-radius: 3px;
        background: #fff;
        color: #888;
        cursor: pointer;
        line-height: 1.2;
      }

      .copy-btn:hover {
        background: #f5f5f5;
        color: #555;
      }

      .output-value {
        margin: 0;
        max-height: 260px;
        overflow: auto;
        font-size: 0.72rem;
        font-family: "SF Mono", "Fira Code", "Fira Mono", Menlo, Consolas, monospace;
        white-space: pre-wrap;
        word-break: break-word;
        color: #555;
      }

      .output-value.has-content {
        color: #1a1a1a;
      }

      .button-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
      }

      /* ── Log ── */

      .log-card {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-top: 1rem;
      }

      .log-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        border-bottom: 1px solid #f0f0f0;
      }

      .log-header h2 {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #666;
        margin: 0;
      }

      .log-clear-btn {
        font-size: 0.65rem;
        padding: 0.2rem 0.5rem;
        border: 1px solid #ddd;
        border-radius: 3px;
        background: #fff;
        color: #888;
        cursor: pointer;
      }

      .log-clear-btn:hover {
        background: #f5f5f5;
        color: #555;
      }

      #log {
        font-family: "SF Mono", "Fira Code", "Fira Mono", Menlo, Consolas, monospace;
        font-size: 0.75rem;
        line-height: 1.5;
        max-height: 300px;
        overflow-y: auto;
        padding: 0.5rem 1rem;
      }

      #log:empty::after {
        content: "No log entries yet.";
        color: #bbb;
        font-style: italic;
      }

      .log-entry {
        padding: 0.2rem 0;
        border-bottom: 1px solid #f5f5f5;
        word-break: break-all;
      }

      .log-entry:last-child {
        border-bottom: none;
      }

      .log-info { color: #777; }
      .log-success { color: #1b7a2b; }
      .log-error { color: #c0392b; }
      .log-json { color: #333; }

      .log-label {
        font-weight: 600;
        margin-bottom: 0.2rem;
      }

      .log-json pre {
        margin: 0;
        padding: 0.4rem;
        background: #f8f9fa;
        border-radius: 4px;
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-word;
      }
    </style>
  </head>
  <body>
    <h1>CubeSigner Google Login Test</h1>
    <p class="subtitle">Each tab is independent. Outputs auto-fill the next step's input, or paste manually.</p>

    <!-- Collapsible config -->
    <button class="config-toggle" id="config-toggle">
      <span class="chevron">&#9660;</span> Configuration
    </button>
    <div class="config-body" id="config-body">
      <div class="form-row">
        <div class="form-group">
          <label for="orgId">CubeSigner Org ID</label>
          <input type="text" id="orgId" placeholder="Org#..." spellcheck="false" />
        </div>
        <div class="form-group">
          <label>Environment</label>
          <input type="text" value="gamma" readonly />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="googleClientId">Google Client ID</label>
          <input type="text" id="googleClientId" placeholder="xxx.apps.googleusercontent.com" spellcheck="false" />
        </div>
        <div class="form-group">
          <label for="scopes">Scopes (comma-separated)</label>
          <input type="text" id="scopes" placeholder="sign:*,manage:*,export:*" spellcheck="false" />
        </div>
      </div>
    </div>

    <!-- Tab navigation -->
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="tab-google-login">1. Google Login <span class="tab-dot" data-dot="google-login"></span></button>
      <button class="tab-btn" data-tab="tab-identity-proof">2. Identity Proof <span class="tab-dot" data-dot="identity-proof"></span></button>
      <button class="tab-btn" data-tab="tab-create-user">3. Create User <span class="tab-dot" data-dot="create-user"></span></button>
      <button class="tab-btn" data-tab="tab-session-token">4. Session Token <span class="tab-dot" data-dot="session-token"></span></button>
      <button class="tab-btn" data-tab="tab-full-flow">Full Flow <span class="tab-dot" data-dot="full-flow"></span></button>
    </div>

    <!-- Tab 1: Google Login -->
    <div id="tab-google-login" class="tab-panel active">
      <div class="step-card">
        <div class="step-header">Sign in with Google</div>
        <p class="step-description">Click the button below. The raw ID token will appear in the output and auto-fill Steps 2 &amp; 4.</p>
        <div id="google-signin-btn"></div>
        <div class="output-block">
          <div class="output-header">
            <span class="output-title">Google ID Token</span>
            <button class="copy-btn" data-copy="output-id-token">Copy</button>
          </div>
          <pre id="output-id-token" class="output-value">Waiting for sign-in...</pre>
        </div>
      </div>
    </div>

    <!-- Tab 2: Identity Proof -->
    <div id="tab-identity-proof" class="tab-panel">
      <div class="step-card">
        <div class="step-header">Exchange ID Token for Identity Proof</div>
        <p class="step-description">Paste a Google ID token below (auto-filled from Step 1) and click the button.</p>
        <div class="form-group">
          <label for="input-id-token-for-proof">Google ID Token</label>
          <textarea id="input-id-token-for-proof" rows="2" placeholder="eyJhbGci..." spellcheck="false"></textarea>
        </div>
        <div class="button-row">
          <button id="action-create-identity-proof" class="primary">Create Identity Proof</button>
        </div>
        <div class="output-block">
          <div class="output-header">
            <span class="output-title">Identity Proof</span>
            <button class="copy-btn" data-copy="output-identity-proof">Copy</button>
          </div>
          <pre id="output-identity-proof" class="output-value">No output yet.</pre>
        </div>
      </div>
    </div>

    <!-- Tab 3: Create User -->
    <div id="tab-create-user" class="tab-panel">
      <div class="step-card">
        <div class="step-header">Send Proof to Create User</div>
        <p class="step-description">Paste identity proof JSON below (auto-filled from Step 2) and click the button.</p>
        <div class="form-group">
          <label for="input-identity-proof-for-user">Identity Proof (JSON)</label>
          <textarea id="input-identity-proof-for-user" rows="4" placeholder='{"identity_proof": ...}' spellcheck="false"></textarea>
        </div>
        <div class="button-row">
          <button id="action-create-user" class="primary">Create User</button>
        </div>
        <div class="output-block">
          <div class="output-header">
            <span class="output-title">User Creation Result</span>
            <button class="copy-btn" data-copy="output-user-result">Copy</button>
          </div>
          <pre id="output-user-result" class="output-value">No output yet.</pre>
        </div>
      </div>
    </div>

    <!-- Tab 4: Session Token -->
    <div id="tab-session-token" class="tab-panel">
      <div class="step-card">
        <div class="step-header">Exchange ID Token for Session Token</div>
        <p class="step-description">Paste a Google ID token below (auto-filled from Step 1) and click the button.</p>
        <div class="form-group">
          <label for="input-id-token-for-session">Google ID Token</label>
          <textarea id="input-id-token-for-session" rows="2" placeholder="eyJhbGci..." spellcheck="false"></textarea>
        </div>
        <div class="button-row">
          <button id="action-create-session" class="primary">Create Session Token</button>
        </div>
        <div class="output-block">
          <div class="output-header">
            <span class="output-title">Session Token</span>
            <button class="copy-btn" data-copy="output-session-token">Copy</button>
          </div>
          <pre id="output-session-token" class="output-value">No output yet.</pre>
        </div>
      </div>
    </div>

    <!-- Tab 5: Full Flow -->
    <div id="tab-full-flow" class="tab-panel">
      <div class="step-card">
        <div class="step-header">One-Click Full Flow</div>
        <p class="step-description">
          Triggers a fresh Google login, then automatically creates identity proof, provisions the user, and exchanges for a session token.
        </p>
        <div class="button-row">
          <button id="action-run-full-flow" class="primary">Run Full Flow</button>
        </div>
        <div class="output-block">
          <div class="output-header">
            <span class="output-title">Session Token (Full Flow)</span>
            <button class="copy-btn" data-copy="output-full-flow-result">Copy</button>
          </div>
          <pre id="output-full-flow-result" class="output-value">No output yet.</pre>
        </div>
      </div>
    </div>

    <!-- Log -->
    <div class="log-card">
      <div class="log-header">
        <h2>Log</h2>
        <button class="log-clear-btn" id="log-clear-btn">Clear</button>
      </div>
      <div id="log"></div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
